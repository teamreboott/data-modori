2023-12-13 18:58:00.851 | INFO     | data_juicer.config.config:config_backup:398 - Back up the input config file [/home/kyuheon/jy_workspace/reboott_llm_pipeline/data-juicer/./configs/process.yaml] into the work_dir [./output]
2023-12-13 18:58:00.858 | INFO     | data_juicer.config.config:display_config:417 - Configuration table: 
╒════════════════════════╤════════════════════════════════════════════════════════════════════════════════════════════════════╕
│ key                    │ values                                                                                             │
╞════════════════════════╪════════════════════════════════════════════════════════════════════════════════════════════════════╡
│ config                 │ [Path_fr(./configs/process.yaml, cwd=/home/kyuheon/jy_workspace/reboott_llm_pipeline/data-juicer)] │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ project_name           │ 'demo-process'                                                                                     │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ executor_type          │ 'default'                                                                                          │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ dataset_path           │ './data/test.json'                                                                                 │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_path            │ './output/test.jsonl'                                                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_shard_size      │ 0                                                                                                  │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_in_parallel     │ False                                                                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ np                     │ 1                                                                                                  │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ text_keys              │ 'content'                                                                                          │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ suffixes               │ []                                                                                                 │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ use_cache              │ True                                                                                               │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ ds_cache_dir           │ PosixPath('/home/kyuheon/.cache/huggingface/datasets')                                             │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ cache_compress         │ None                                                                                               │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ use_checkpoint         │ False                                                                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ temp_dir               │ None                                                                                               │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ open_tracer            │ False                                                                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ op_list_to_trace       │ []                                                                                                 │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ trace_num              │ 10                                                                                                 │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ op_fusion              │ False                                                                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ process                │ [{'alphanumeric_filter': {'max_ratio': 1.0,                                                        │
│                        │                           'min_ratio': 0.3,                                                        │
│                        │                           'text_key': 'content',                                                   │
│                        │                           'tokenization': True}},                                                  │
│                        │  {'average_line_length_filter': {'max_len': 10000,                                                 │
│                        │                                  'min_len': 5,                                                     │
│                        │                                  'text_key': 'content'}},                                          │
│                        │  {'character_repetition_filter': {'max_ratio': 0.5,                                                │
│                        │                                   'min_ratio': 0.0,                                                │
│                        │                                   'rep_len': 50,                                                   │
│                        │                                   'text_key': 'content'}},                                         │
│                        │  {'flagged_words_filter': {'flagged_words_dir': './assets',                                        │
│                        │                            'lang': 'ko',                                                           │
│                        │                            'max_ratio': 0.0045,                                                    │
│                        │                            'text_key': 'content',                                                  │
│                        │                            'tokenization': False,                                                  │
│                        │                            'use_words_aug': False,                                                 │
│                        │                            'words_aug_group_sizes': [2],                                           │
│                        │                            'words_aug_join_char': ''}},                                            │
│                        │  {'language_id_score_filter': {'lang': 'ko',                                                       │
│                        │                                'min_score': 0.3,                                                   │
│                        │                                'text_key': 'content'}},                                            │
│                        │  {'maximum_line_length_filter': {'max_len': 10000,                                                 │
│                        │                                  'min_len': 10,                                                    │
│                        │                                  'text_key': 'content'}},                                          │
│                        │  {'perplexity_filter': {'lang': 'en', 'max_ppl': 1500, 'text_key': 'content'}}]                    │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ save_stats_in_one_file │ False                                                                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ ray_address            │ 'auto'                                                                                             │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ work_dir               │ './output'                                                                                         │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ timestamp              │ '20231213185800'                                                                                   │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ add_suffix             │ False                                                                                              │
╘════════════════════════╧════════════════════════════════════════════════════════════════════════════════════════════════════╛
2023-12-13 18:58:00.859 | INFO     | data_juicer.core.executor:__init__:40 - Using cache compression method: [None]
2023-12-13 18:58:00.859 | INFO     | data_juicer.core.executor:__init__:45 - Setting up data formatter...
2023-12-13 18:58:00.860 | INFO     | data_juicer.core.executor:__init__:67 - Preparing exporter...
2023-12-13 18:58:00.860 | INFO     | data_juicer.core.executor:run:96 - Loading dataset from data formatter...
2023-12-13 18:58:01.642 | INFO     | logging:handle:954 - Found cached dataset json (/home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e)
  0%|          | 0/1 [00:00<?, ?it/s]100%|##########| 1/1 [00:00<00:00, 607.96it/s]
2023-12-13 18:58:01.648 | INFO     | data_juicer.format.formatter:unify_format:173 - Unifying the input dataset formats...
2023-12-13 18:58:01.648 | INFO     | data_juicer.format.formatter:unify_format:188 - There are 11 sample(s) in the original dataset.
2023-12-13 18:58:01.650 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-53f04966f89e1347.arrow
2023-12-13 18:58:01.653 | INFO     | data_juicer.format.formatter:unify_format:202 - 11 samples left after filtering empty text.
2023-12-13 18:58:01.654 | INFO     | data_juicer.format.mixture_formatter:load_dataset:95 - sampled 11 from 11 with weight 1.0
2023-12-13 18:58:01.657 | INFO     | data_juicer.format.mixture_formatter:load_dataset:101 - There are 11 in final dataset
2023-12-13 18:58:01.658 | INFO     | data_juicer.core.executor:run:102 - Preparing process operators...
using cached model. /home/kyuheon/jy_workspace/reboott_llm_pipeline/data-juicer/.cache/kobert_news_wiki_ko_cased-1087f8699e.spiece
2023-12-13 18:58:01.677 | INFO     | data_juicer.utils.model_utils:prepare_fasttext_model:100 - Loading fasttext language identification model...
Warning : `load_model` does not return WordVectorModel or SupervisedModel any more, but a `FastText` object which is very similar.
2023-12-13 18:58:01.816 | INFO     | data_juicer.utils.model_utils:prepare_sentencepiece_model:120 - Loading sentencepiece model...
2023-12-13 18:58:01.869 | INFO     | data_juicer.utils.model_utils:prepare_kenlm_model:142 - Loading kenlm language model...
2023-12-13 18:58:02.085 | INFO     | data_juicer.core.executor:run:109 - Processing data...
2023-12-13 18:58:02.091 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-3bcbe15cca616b89.arrow
/home/kyuheon/.virtualenvs/PKNU/lib/python3.8/site-packages/datasets/table.py:1373: FutureWarning: promote has been superseded by mode='default'.
  return cls._concat_blocks(pa_tables_to_concat_vertically, axis=0)
2023-12-13 18:58:02.097 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-257c50cbc7a2b7d4.arrow
2023-12-13 18:58:02.100 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-5d36ed7afcb76b59.arrow
2023-12-13 18:58:02.101 | INFO     | data_juicer.core.executor:run:188 - Op [alphanumeric_filter] Done in 0.016(s). Left 11 samples.
2023-12-13 18:58:02.104 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-46a18c4174dd9ac7.arrow
2023-12-13 18:58:02.107 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-094b5f9c55fb7fc8.arrow
2023-12-13 18:58:02.108 | INFO     | data_juicer.core.executor:run:188 - Op [average_line_length_filter] Done in 0.007(s). Left 11 samples.
2023-12-13 18:58:02.110 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-cff9d38657629ec4.arrow
2023-12-13 18:58:02.113 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-4403bb3ec9bc6569.arrow
2023-12-13 18:58:02.114 | INFO     | data_juicer.core.executor:run:188 - Op [character_repetition_filter] Done in 0.006(s). Left 11 samples.
2023-12-13 18:58:02.125 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-5688d1f57447a451.arrow
2023-12-13 18:58:02.135 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-9133d88067d6daa2.arrow
2023-12-13 18:58:02.136 | INFO     | data_juicer.core.executor:run:188 - Op [flagged_words_filter] Done in 0.022(s). Left 8 samples.
2023-12-13 18:58:02.139 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-ad0410c2bd1da9e0.arrow
2023-12-13 18:58:02.142 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-aa63b82778808097.arrow
2023-12-13 18:58:02.143 | INFO     | data_juicer.core.executor:run:188 - Op [language_id_score_filter] Done in 0.006(s). Left 2 samples.
2023-12-13 18:58:02.145 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-a0d047390c0cde10.arrow
2023-12-13 18:58:02.148 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-845d7c6b6139432f.arrow
2023-12-13 18:58:02.149 | INFO     | data_juicer.core.executor:run:188 - Op [maximum_line_length_filter] Done in 0.006(s). Left 2 samples.
perplexity_filter_compute_stats:   0%|          | 0/2 [00:00<?, ? examples/s]['▁', '본', '▁', '논문에서는', '▁L', 'LM', '▁', '사전훈련에', '▁', '관한', '▁', '새로운', '▁', '방법을', '▁', '제안하였습니다', '.']
29309.126047906684
['▁', '안녕하세요', '?', '▁', '이', '번', '▁', '글은', '▁', '지리공간', '▁', '딥러닝용', '▁', '지표수', '(', 'Earth', '▁Surface', '▁Water', ')', '▁', '데', '이', '터셋을', '▁', '간략', '▁', '소개해', '▁', '보겠습니다', '.', '▁', '이', '▁', '글은', '▁', '지리공간', '/', '금융', '▁', '데', '이', '터', '▁', '사', '이', '언티스트', '▁Maur', 'í', 'cio', '▁Cord', 'eiro', '(', '마우리시오', '▁', '코르데', '이', '로', ')', '▁', '님', '이', '▁', '작성하신', "▁'", 'P', 'y', 'Tor', 'ch', '의', '▁Torch', 'Ge', 'o', '를', '▁', '이', '용한', '▁', '지리공간', '▁', '분석용', '▁', '인공지능', '(', '1', '부', ')', "'", '▁', '내용', '▁', '일부를', '▁', '발췌', ',', '▁', '보완한', '▁', '것입니다', '.']
24701.729179028927
                                                                             perplexity_filter_process:   0%|          | 0/2 [00:00<?, ? examples/s]                                                                       2023-12-13 18:58:02.166 | INFO     | data_juicer.core.executor:run:188 - Op [perplexity_filter] Done in 0.017(s). Left 0 samples.
2023-12-13 18:58:02.166 | INFO     | data_juicer.core.executor:run:192 - All Ops are done in 0.081(s).
2023-12-13 18:58:02.166 | INFO     | data_juicer.core.executor:run:195 - Exporting dataset to disk...
2023-12-13 18:58:02.167 | INFO     | data_juicer.core.exporter:_export_impl:106 - Export dataset into a single file...
Creating json from Arrow format: 0ba [00:00, ?ba/s]Creating json from Arrow format: 0ba [00:00, ?ba/s]
Creating json from Arrow format: 0ba [00:00, ?ba/s]Creating json from Arrow format: 0ba [00:00, ?ba/s]
