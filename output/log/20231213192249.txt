2023-12-13 19:22:49.142 | INFO     | data_juicer.config.config:config_backup:398 - Back up the input config file [/home/kyuheon/jy_workspace/reboott_llm_pipeline/data-juicer/./configs/process.yaml] into the work_dir [./output]
2023-12-13 19:22:49.148 | INFO     | data_juicer.config.config:display_config:417 - Configuration table: 
╒════════════════════════╤════════════════════════════════════════════════════════════════════════════════════════════════════╕
│ key                    │ values                                                                                             │
╞════════════════════════╪════════════════════════════════════════════════════════════════════════════════════════════════════╡
│ config                 │ [Path_fr(./configs/process.yaml, cwd=/home/kyuheon/jy_workspace/reboott_llm_pipeline/data-juicer)] │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ project_name           │ 'demo-process'                                                                                     │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ executor_type          │ 'default'                                                                                          │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ dataset_path           │ './data/test.json'                                                                                 │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_path            │ './output/test.jsonl'                                                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_shard_size      │ 0                                                                                                  │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ export_in_parallel     │ False                                                                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ np                     │ 1                                                                                                  │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ text_keys              │ 'content'                                                                                          │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ suffixes               │ []                                                                                                 │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ use_cache              │ True                                                                                               │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ ds_cache_dir           │ PosixPath('/home/kyuheon/.cache/huggingface/datasets')                                             │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ cache_compress         │ None                                                                                               │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ use_checkpoint         │ False                                                                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ temp_dir               │ None                                                                                               │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ open_tracer            │ False                                                                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ op_list_to_trace       │ []                                                                                                 │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ trace_num              │ 10                                                                                                 │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ op_fusion              │ False                                                                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ process                │ [{'perplexity_filter': {'lang': 'ko', 'max_ppl': 1500, 'text_key': 'content'}}]                    │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ save_stats_in_one_file │ False                                                                                              │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ ray_address            │ 'auto'                                                                                             │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ work_dir               │ './output'                                                                                         │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ timestamp              │ '20231213192249'                                                                                   │
├────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ add_suffix             │ False                                                                                              │
╘════════════════════════╧════════════════════════════════════════════════════════════════════════════════════════════════════╛
2023-12-13 19:22:49.149 | INFO     | data_juicer.core.executor:__init__:40 - Using cache compression method: [None]
2023-12-13 19:22:49.149 | INFO     | data_juicer.core.executor:__init__:45 - Setting up data formatter...
2023-12-13 19:22:49.149 | INFO     | data_juicer.core.executor:__init__:67 - Preparing exporter...
2023-12-13 19:22:49.150 | INFO     | data_juicer.core.executor:run:96 - Loading dataset from data formatter...
2023-12-13 19:22:49.934 | INFO     | logging:handle:954 - Found cached dataset json (/home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e)
  0%|          | 0/1 [00:00<?, ?it/s]100%|##########| 1/1 [00:00<00:00, 609.28it/s]
2023-12-13 19:22:49.939 | INFO     | data_juicer.format.formatter:unify_format:173 - Unifying the input dataset formats...
2023-12-13 19:22:49.939 | INFO     | data_juicer.format.formatter:unify_format:188 - There are 11 sample(s) in the original dataset.
2023-12-13 19:22:49.942 | INFO     | logging:handle:954 - Loading cached processed dataset at /home/kyuheon/.cache/huggingface/datasets/json/default-b72633ba65863c11/0.0.0/fe5dd6ea2639a6df622901539cb550cf8797e5a6b2dd7af1cf934bed8e233e6e/cache-53f04966f89e1347.arrow
2023-12-13 19:22:49.944 | INFO     | data_juicer.format.formatter:unify_format:202 - 11 samples left after filtering empty text.
2023-12-13 19:22:49.946 | INFO     | data_juicer.format.mixture_formatter:load_dataset:95 - sampled 11 from 11 with weight 1.0
2023-12-13 19:22:49.951 | INFO     | data_juicer.format.mixture_formatter:load_dataset:101 - There are 11 in final dataset
2023-12-13 19:22:49.952 | INFO     | data_juicer.core.executor:run:102 - Preparing process operators...
2023-12-13 19:22:49.956 | INFO     | data_juicer.utils.model_utils:prepare_sentencepiece_model:122 - Loading sentencepiece model...
using cached model. /home/kyuheon/jy_workspace/reboott_llm_pipeline/data-juicer/.cache/kobert_news_wiki_ko_cased-1087f8699e.spiece
2023-12-13 19:22:49.969 | INFO     | data_juicer.utils.model_utils:prepare_kenlm_model:144 - Loading kenlm language model...
2023-12-13 19:22:49.969 | ERROR    | __main__:<module>:19 - An error has been caught in function '<module>', process 'MainProcess' (1469900), thread 'MainThread' (140487741933376):
Traceback (most recent call last):

> File "tools/process_data.py", line 19, in <module>
    main()
    └ <function main at 0x7fc3b3250790>

  File "tools/process_data.py", line 15, in main
    executor.run()
    │        └ <function Executor.run at 0x7fc3ab226e50>
    └ <data_juicer.core.executor.Executor object at 0x7fc3ab18fa60>

  File "/home/kyuheon/jy_workspace/reboott_llm_pipeline/data-juicer/data_juicer/core/executor.py", line 103, in run
    self.process_list, self.ops = load_ops(self.cfg.process,
    │    │             │    │     │        │    │   └ [{'perplexity_filter': {'lang': 'ko', 'max_ppl': 1500, 'text_key': 'content'}}]
    │    │             │    │     │        │    └ Namespace(add_suffix=False, alphanumeric_filter=Namespace(max_ratio=9223372036854775807, min_ratio=0.25, text_key=None, token...
    │    │             │    │     │        └ <data_juicer.core.executor.Executor object at 0x7fc3ab18fa60>
    │    │             │    │     └ <function load_ops at 0x7fc3b3250430>
    │    │             │    └ None
    │    │             └ <data_juicer.core.executor.Executor object at 0x7fc3ab18fa60>
    │    └ [{'perplexity_filter': {'lang': 'ko', 'max_ppl': 1500, 'text_key': 'content'}}]
    └ <data_juicer.core.executor.Executor object at 0x7fc3ab18fa60>

  File "/home/kyuheon/jy_workspace/reboott_llm_pipeline/data-juicer/data_juicer/ops/load.py", line 17, in load_ops
    ops.append(OPERATORS.modules[op_name](**args))
    │   │      │         │       │          └ {'lang': 'ko', 'max_ppl': 1500, 'text_key': 'content'}
    │   │      │         │       └ 'perplexity_filter'
    │   │      │         └ <property object at 0x7fc5d8a42220>
    │   │      └ <data_juicer.utils.registry.Registry object at 0x7fc5d8b35670>
    │   └ <method 'append' of 'list' objects>
    └ []

  File "/home/kyuheon/jy_workspace/reboott_llm_pipeline/data-juicer/data_juicer/ops/filter/perplexity_filter.py", line 40, in __init__
    self.kl_model_key = prepare_model(lang=lang, model_type='kenlm')
    │                   │                  └ 'ko'
    │                   └ <function prepare_model at 0x7fc49c263b80>
    └ <data_juicer.ops.filter.perplexity_filter.PerplexityFilter object at 0x7fc3ab1a1400>

  File "/home/kyuheon/jy_workspace/reboott_llm_pipeline/data-juicer/data_juicer/utils/model_utils.py", line 282, in prepare_model
    MODEL_ZOO[model_key] = model_func(model_name, lang)
    │         │            │          │           └ 'ko'
    │         │            │          └ '%s.arpa.bin'
    │         │            └ <function prepare_kenlm_model at 0x7fc49c2638b0>
    │         └ 'kenlm_ko'
    └ {'sentencepiece_ko': <gluonnlp.data.transforms.SentencepieceTokenizer object at 0x7fc3a96776a0>}

  File "/home/kyuheon/jy_workspace/reboott_llm_pipeline/data-juicer/data_juicer/utils/model_utils.py", line 145, in prepare_kenlm_model
    kenlm_model = kenlm.KenlmModel.from_pretrained("wikipedia", "en")
                  └ <module 'kenlm' from '/home/kyuheon/.virtualenvs/PKNU/lib/python3.8/site-packages/kenlm.cpython-38-x86_64-linux-gnu.so'>

AttributeError: module 'kenlm' has no attribute 'KenlmModel'
